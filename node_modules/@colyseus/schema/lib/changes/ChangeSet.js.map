{"version":3,"file":"ChangeSet.js","sourceRoot":"","sources":["../../src/changes/ChangeSet.ts"],"names":[],"mappings":";;;AAAA,kCAAoC;AAIpC,MAAa,SAAS;IAClB,OAAO,GAAyC,EAAE,CAAC;IACnD,OAAO,GAAY,KAAK,CAAC;IACzB,UAAU,GAAgB,IAAI,GAAG,EAAE,CAAC;IACpC,gCAAgC;IAEhC,MAAM,CAAC,KAAa,EAAE,YAAuB,gBAAS,CAAC,GAAG;QACtD,MAAM,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAE3C,IACI,CAAC,cAAc;YACf,cAAc,CAAC,EAAE,KAAK,gBAAS,CAAC,MAAM;YACtC,cAAc,CAAC,EAAE,KAAK,gBAAS,CAAC,KAAK,CAAC,qCAAqC;UAC7E,CAAC;YACC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG;gBAClB,EAAE,EAAE,CAAC,CAAC,cAAc,CAAC;oBACjB,CAAC,CAAC,SAAS;oBACX,CAAC,CAAC,CAAC,cAAc,CAAC,EAAE,KAAK,gBAAS,CAAC,MAAM,CAAC;wBACtC,CAAC,CAAC,gBAAS,CAAC,cAAc;wBAC1B,CAAC,CAAC,SAAS;gBACnB,KAAK;aACR,CAAC;QACN,CAAC;QAED,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAE3B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACxB,CAAC;IAED,UAAU;QACN,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;IACtB,CAAC;IAED,SAAS,CAAC,GAAG,IAAW;IACxB,CAAC;CAEJ;AApCD,8BAoCC","sourcesContent":["import { OPERATION } from \"../spec\";\nimport { SchemaDefinition } from \"../annotations\";\nimport { ChangeOperation, Ref } from \"./ChangeTree\";\n\nexport class ChangeSet {\n    changes: { [index: number]: ChangeOperation } = {};\n    changed: boolean = false;\n    allChanges: Set<number> = new Set();\n    // definition: SchemaDefinition;\n\n    change(index: number, operation: OPERATION = OPERATION.ADD) {\n        const previousChange = this.changes[index];\n\n        if (\n            !previousChange ||\n            previousChange.op === OPERATION.DELETE ||\n            previousChange.op === OPERATION.TOUCH // (mazmorra.io's BattleAction issue)\n        ) {\n            this.changes[index] = {\n                op: (!previousChange)\n                    ? operation\n                    : (previousChange.op === OPERATION.DELETE)\n                        ? OPERATION.DELETE_AND_ADD\n                        : operation,\n                index\n            };\n        }\n\n        this.allChanges.add(index);\n\n        this.changed = true;\n    }\n\n    discardAll() {\n        this.changes = {};\n    }\n\n    setParent(...args: any[]) {\n    }\n\n}"]}